name: Lambda_Deploy

on:
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë§Œ ê°€ëŠ¥
  # push:
  #   branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: aws-actions/setup-sam@v2
      
      - uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-west-2
      
      - name: Build SAM application
        run: sam build
      
      - name: Deploy SAM application
        id: deploy
        run: sam deploy --no-confirm-changeset --no-fail-on-empty-changeset
      
      - name: Send Slack notification (Success)
        if: success()
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_TITLE: "ğŸš€ SES Email Service ë°°í¬ ì„±ê³µ"
          SLACK_MESSAGE: |
            ğŸ“‹ ë°°í¬ ì •ë³´:
            â€¢ Branch: `${{ github.ref_name }}`
            â€¢ Commit: `${{ github.sha }}`
            â€¢ Message: ${{ github.event.head_commit.message }}
            â€¢ Actor: `${{ github.actor }}`
            â€¢ Workflow: `${{ github.workflow }}`
            
            ğŸŸ¢ ì„œë¹„ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤!
          SLACK_COLOR: "#36a64f"
          SLACK_FOOTER: "GitHub Actions"
      
      - name: Send Slack notification (Failure)
        if: failure()
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_TITLE: "âŒ SES Email Service ë°°í¬ ì‹¤íŒ¨"
          SLACK_MESSAGE: |
            ğŸ“‹ ë°°í¬ ì •ë³´:
            â€¢ Branch: `${{ github.ref_name }}`
            â€¢ Commit: `${{ github.sha }}`
            â€¢ Message: ${{ github.event.head_commit.message }}
            â€¢ Actor: `${{ github.actor }}`
            â€¢ Workflow: `${{ github.workflow }}`
            
            ğŸ”— ë¡œê·¸ í™•ì¸: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
          SLACK_COLOR: "#ff0000"
          SLACK_FOOTER: "GitHub Actions"